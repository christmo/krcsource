<?phpinclude "php/login/isLogin.php";echo "<script type='text/javascript'>    var tmpAlerts;    //Tiempo para consulta de alertas    var placaVh;    var sb;    var seguirVehiculo = false;    Ext.onReady(function(){        var tb = new Ext.Toolbar();        var idEqpMen;                var mnuContext = new Ext.menu.Menu({            items: [{                    id: 'opt1',                    text: 'Hoy'                },{                    id: 'opt2',                    text: 'Ayer'                },{                    id: 'opt3',                    text: 'Recorrido'                }],            listeners: {                itemclick: function(item) {                    if (item.id == 'opt3') {                        ventanaRecorridos(idEqpMen);                    }else{                        //fecha actual                        var nowDate = new Date();                        if (item.id == 'opt2') {                            nowDate.setDate(nowDate.getDate() - 1);                        }else{                            nowDate.setMinutes(nowDate.getMinutes() + 10);                        }                        var fi = nowDate.format('Y-m-d');                        var hi = '00:01';                        var ff = nowDate.format('Y-m-d');                        var id = idEqpMen;                        var hf = (item.id == 'opt2')?'23:59':nowDate.format('H:i');                        Ext.Ajax.request({                            url: 'php/monitoreo/datos_ruta_mapa.php',                            success: function(response){                                var resultado = Ext.util.JSON.decode(response.responseText);                                lienzosRecorridoHistorico(placaVh,resultado.datos.coordenadas);                                limpiar_datos();                            },                            failure: function(){                                console.warn('error');                            },                            params: { fechaIni: fi,                                fechaFin: ff,                                horaIni: hi,                                horaFin: hf,                                idVeh: id}                        });                    }                }            }        });        var boxCheck = {            xtype: 'checkbox',            boxLabel: 'Seguir Vehículo',            handler: function(d){                if (d.getValue()) {                    seguirVehiculo = true;                }else{                    seguirVehiculo = false;                }            }        };        tb.add('-',{            xtype: 'tbbutton',            cls: 'x-btn-text-icon',            icon: 'img/historico.png',            text: 'Recorridos',            menu: [{                    text: 'Trazar Nuevo',                    icon: 'img/lapiz.png',                    handler: function(){                        ventanaRecorridos(0);                    }                },                {                    text: 'Borrar Actual',                    icon: 'img/borrar.png',                    handler: function(){                        limpiarRecorrido();                    }                },'-',                {                    text: 'Simbología',                    icon: 'img/paleta.png',                    handler: function(){                        ventanaSimbolos();                    }                }            ]        },        '-',{            xtype: 'tbbutton',            cls: 'x-btn-text-icon',            icon: 'img/g.png',            text: 'GeoCercas',            menu: [{                    text: 'Ver',                    icon: 'img/v.png',                    handler: function(){                        g1Window();                    }                },'-',                {                    text: 'Agregar',                    icon: 'img/p.png',                    handler: function(){                        g2Window();                    }                }            ]        },        '-',{            xtype: 'tbbutton',            cls: 'x-btn-text-icon',            icon: 'img/reportMain.png',            text: 'Reportes',            menu: [{                    text: 'General',                    icon: 'img/general.png',                    handler: function(){                        vent_rep_gen();                    }                },{                    text: 'Datos Ruta',                    icon: 'img/informe.png',                    handler: function(){                        ventReporte();                    }                },{                    text: 'Eventos',                    icon: 'img/eventos.png',                    handler: function(){                        ventReporteEvt();                    }                }                ,{                    text: 'Geocercas',                    icon: 'img/gcerca.png',                    handler: function(){                        gccWindow();                    }                },{                    text: 'Paradas',                    icon: 'img/stop.png',                    handler: function(){                        prdWindow();                    }                },{                    text: 'Encendido/Apg',                    icon: 'img/onoff.png',                    handler: function(){                        OnWindow();                    }                },{                    text: 'Flota',                    icon: 'img/flota.png',                    handler: function(){                        fltWindow();                    }                }            ]        },'-',        {            xtype: 'tbbutton',            icon: 'img/veh.png',            text: 'Vehiculo',            menu: [{                    text: 'Localizar',                    icon: 'img/buscar.png',                    handler: function(){                        ventBusquedaWin();                    }                }]        },'-',{            xtype: 'tbbutton',            icon: 'img/mundo.png',            text: 'Mapa',            menu: [{                    text: 'Imprimir',                    icon : 'img/print.png',                    handler: function(){                       cmdHWindow();                }                }]        },'-',";IF ($_SESSION["ROL"] == 1 || $_SESSION["ROL"] == 2) {    echo "{            xtype: 'tbbutton',            cls: 'x-btn-text-icon',            icon: 'img/admin.png',            text: 'Administracion',            menu: [                {                    text: 'Vehiculos',                    icon: 'img/car.png',                    menu:[                        {                            text: 'Nuevo Vehiculo',                            icon: 'img/addCar.png',                            handler: function(){                                  newVhWindow();                               }                        },                        {                            text: 'Ver Vehiculos',                            icon: 'img/carV.png',                            handler: function(){                                edVhWindow();                               }                        },                        {                            text: 'Vincular Vehiculos',                            icon: 'img/link.png',                            handler: function(){                                linkVhWindow();                               }                        },{                            text: 'Enviar CMD',                            icon: 'img/cmd.png',                            handler: function(){                                  cmdEnvWindow();                               }                        }                ]                },{                    text: 'Usuarios',                    icon: 'img/user.png',                    menu:[                          {                            text: 'Nuevo Usuario',                            icon: 'img/nus.png',                            handler: function(){                                newUsWindow();                            }                          },                          {                            text: 'Ver Usuarios',                            icon: 'img/usView.png',                            handler: function(){                                editUsWindow();                            }                          }                    ]                },{                    text: 'Instalaciones',                    icon: 'img/inst.png',                     menu:[                          {                            text: 'Registro',                            icon: 'img/ri.png',                            handler: function(){                                regInsWindow();                            }                          }                    ]                    }                ]            },'-',";}echo "{            xtype: 'tbbutton',            icon: 'img/panel.png',            text: 'Aplicacion',            menu: [{                    text: 'Acerca de...',                    icon : 'img/info.png',                    handler: function(){                        credits();                    }                },                {                    text: 'Ayuda',                    icon : 'img/help.png',                    handler: function(){                        //Ayuda sobre la App                    }                }]        }, {            text: 'Salir',            icon : 'img/salir.png',            handler: function(){                window.location = 'php/login/logout.php';            }        });        tb.doLayout();        var BarTool = {            id: 'content-panel-bar',            region: 'center',            layout: 'fit',            margins: '0 0 0 0',            tbar: tb,            border: false        };        new Ext.Viewport({            layout: 'border',            items: [                {                    region: 'north',                    height: 100,                    items:[{                            height: 70,                            html: '<div id =";echo '"header"';echo "><h1><CENTER> <b>SISTEMA DE RASTREO SATELITAL  <br /> Loja-Ecuador</b></CENTER>Bienvenido:: " . $_SESSION["USER"] . " al sistema</h1></div>'            },            BarTool            ]        },        {            region: 'west',            id: 'west-panel',            split: true,            width: 200,            minSize: 175,            maxSize: 400,            title: 'Vehiculos',            collapsible: true,            margins: '0 0 0 5',            xtype: 'treepanel',            autoScroll: true,            icon : 'img/help.png',            dataUrl: 'php/monitoreo/json_vehic.php',            root: {                nodeType: 'async',                text: 'Ext JS',                draggable: false,                id: 'src'            },            rootVisible: false,            listeners: {                click: function(n) { ";echo "                      var aux = n.attributes.id;                       if (!isNaN(aux)) {                           buscarVehiculo('T'+aux);                       }else{                           return;                       }                },                              contextmenu: function(e) {                              idEqpMen = e.attributes.id;                placaVh = e.attributes.text;                var posXY = new Array(2) ;                posXY[0] = window.event.clientX ;                posXY[1] = window.event.clientY ;                mnuContext.showAt(posXY);                              }             //              ,//            checkchange : function(node,check){//                console.warn('ok ');//            }            }        },panelCentral],        renderTo: Ext.getBody()    });});    var cmbCompartido;    cmbCompartido = new Ext.data.JsonStore({        url:'php/combos/unidades.php',        root: 'unidades',        fields: [{            name:'id'        },{            name:'name'        }]    });    cmbCompartido.load();    var auxStore;    auxStore = new Ext.data.JsonStore({        url:'php/monitoreo/allGeoc.php',        root: 'dt',        fields: [{            name:'a'        },{            name:'b'        },{            name:'c'        }]    });    auxStore.load();    //-------------------------------    var boxAlerta;    function buscarAlerta(){        Ext.Ajax.request({            url: 'php/monitoreo/checkAlerts.php',            method: 'POST',            params :{                t:tmpAlerts            },            success: function(response){                // Ext.MessageBox.hide();                if (boxAlerta != undefined) {                    boxAlerta.hide();                }                                                var resultado = Ext.util.JSON.decode(response.responseText);                tmpAlerts = resultado.t;                                var msgAlert = '';                for(var i in resultado.d){                    var a = resultado.d[i].a;                    var f = resultado.d[i].f;                    var v = resultado.d[i].v;                    var g = resultado.d[i].g;                    if (a != undefined && f != undefined && v != undefined && g != undefined) {                        var auxA = 'Salido';                        if (a == 1) {                            auxA = 'Entrado';                        }                        msgAlert += '[' + f + '] El vehiculo ' + v + ' ha ' + auxA                        + ' de la Geocerca ' + g + '<br/>';                    }                }                if (msgAlert != '') {                    boxAlerta = Ext.example.msg('',msgAlert);                }                setTimeout( function(){                        buscarAlerta()                    }, 5 * 1000 );            },            failure: function(){            console.warn('Error');            setTimeout( function(){                        buscarAlerta()                    }, 5 * 1000 );            }        });    }</script>";?>